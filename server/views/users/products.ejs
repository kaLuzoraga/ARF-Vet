<!DOCTYPE html>
<html lang="en">

<head>
  <%- include('../partials/head') %>
    <title>Our Products</title>
    <link rel="stylesheet" href="../css/users/products.css" />
</head>

<body>
  <!-- Navbar Partial -->
  <%- include('../partials/navbar') %>

    <!-- Hero Section -->
    <section class="hero">
      <div class="hero-text">
        <h1>Our Products</h1>
        <p>Browse the full collection of veterinary items we offer.</p>
      </div>
    </section>

    <!-- Search and Filter Section -->
    <section class="search-section">
      <div class="search-container">
        <form action="/products" method="GET" class="search-form">
          <div class="search-box">
            <i class="fas fa-search"></i>
            <input 
              type="text" 
              name="search" 
              placeholder="Search products by name or description..." 
              value="<%= typeof searchQuery !== 'undefined' ? searchQuery : '' %>"
              class="search-input"
            />
            <select name="category" class="category-filter">
              <option value="">All Categories</option>
              <option value="Vitamins & Supplements" <%= typeof categoryQuery !== 'undefined' && categoryQuery === 'Vitamins & Supplements' ? 'selected' : '' %>>Vitamins & Supplements</option>
              <option value="Medications" <%= typeof categoryQuery !== 'undefined' && categoryQuery === 'Medications' ? 'selected' : '' %>>Medications</option>
              <option value="Nutrition" <%= typeof categoryQuery !== 'undefined' && categoryQuery === 'Nutrition' ? 'selected' : '' %>>Nutrition</option>
              <option value="Wellness" <%= typeof categoryQuery !== 'undefined' && categoryQuery === 'Wellness' ? 'selected' : '' %>>Wellness</option>
              <option value="Other" <%= typeof categoryQuery !== 'undefined' && categoryQuery === 'Other' ? 'selected' : '' %>>Other</option>
            </select>
            <button type="submit" class="search-btn">Search</button>
            <% if ((typeof searchQuery !== 'undefined' && searchQuery) || (typeof categoryQuery !== 'undefined' && categoryQuery)) { %>
              <a href="/products" class="clear-btn">
                <i class="fas fa-times"></i> Clear
              </a>
            <% } %>
          </div>
        </form>
        <% if ((typeof searchQuery !== 'undefined' && searchQuery) || (typeof categoryQuery !== 'undefined' && categoryQuery)) { %>
          <p class="search-results">
            Found <%= products.length %> result<%= products.length !== 1 ? 's' : '' %>
            <% if (searchQuery) { %> for "<%= searchQuery %>"<% } %>
            <% if (categoryQuery) { %> in <%= categoryQuery %><% } %>
          </p>
        <% } %>
      </div>
    </section>

    <!-- Product Grid -->
    <section class="products">
      <h2>All Products</h2>
      <div class="product-grid">
        <% if (products && products.length> 0) { %>
          <% products.forEach(product=> { %>
            <a href="/products/<%= product._id %>" class="product-card-link">
              <div class="product-card">
                <div class="product-image-wrapper">
                  <img src="<%= product.image || '/img/default.jpg' %>" alt="<%= product.name %>">
                  <% if (product.stock === 0) { %>
                    <div class="out-of-stock-overlay">
                      <span>OUT OF STOCK</span>
                    </div>
                  <% } %>
                </div>
                <h3>
                  <%= product.name %>
                </h3>
                <p>â‚±<%= product.price.toFixed(2) %>
                </p>
                <p>
                  <%= product.description %>
                </p>
                <p><strong>Stock:</strong>
                  <%= product.stock %>
                </p>
                <button>View Item</button>
              </div>
            </a>
            <% }) %>
              <% } else { %>
                <p style="text-align:center;">
                  <% if (typeof searchQuery !== 'undefined' && searchQuery) { %>
                    No products found matching "<%= searchQuery %>". <a href="/products" style="color: #93e9be;">View all products</a>
                  <% } else { %>
                    No products available yet.
                  <% } %>
                </p>
                <% } %>
      </div>
    </section>

    <!-- Footer Partial -->
    <%- include('../partials/footer') %>
</body>

</html>